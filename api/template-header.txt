import type { VercelRequest, VercelResponse } from '@vercel/node';
import { Resend } from 'resend';

const resend = new Resend(process.env.RESEND_API_KEY);

// Professional email templates - clean design, anti-spam optimized
const getProfessionalCustomerEmail = (data: any) => `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Your FixNow Mechanics Quote Request</title>
  <!--[if mso]>
  <style type="text/css">
    body, table, td {font-family: Arial, Helvetica, sans-serif !important;}
  </style>
  <![endif]-->
</head>
<body style="margin:0;padding:0;font-family:Arial,'Helvetica Neue',Helvetica,sans-serif;background-color:#e7e7e7;">
  <table width="100%" cellpadding="0" cellspacing="0" role="presentation" style="background-color:#e7e7e7;">
    <tr>
      <td align="center" style="padding:40px 20px;">
        <table width="600" cellpadding="0" cellspacing="0" role="presentation" style="max-width:600px;width:100%;background-color:#ffffff;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
          
          <!-- Icon Section -->
          <tr>
            <td align="center" style="padding:50px 30px 30px;">
              <div style="width:80px;height:80px;background-color:#17a2b8;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z" fill="#ffffff"/>
                </svg>
              </div>
            </td>
          </tr>

          <!-- Heading -->
          <tr>
            <td align="center" style="padding:0 40px 20px;">
              <h1 style="margin:0;font-size:28px;font-weight:700;color:#1a1a1a;line-height:1.3;">Quote Request Confirmed</h1>
            </td>
          </tr>

          <!-- Description -->
          <tr>
            <td align="center" style="padding:0 40px 30px;">
              <p style="margin:0;font-size:15px;color:#666666;line-height:1.6;">Thank you for contacting <strong style="color:#1a1a1a;">FixNow Mechanics</strong>. Your quote request has been successfully received and our team is now reviewing your submission.</p>
            </td>
          </tr>

          <!-- Details Box -->
          <tr>
            <td style="padding:0 40px 30px;">
              <div style="background:#f8f9fa;border:1px solid #e9ecef;border-radius:6px;padding:25px;">
                <h3 style="margin:0 0 15px;font-size:16px;font-weight:600;color:#1a1a1a;">Your Submission Details</h3>
                <table width="100%" cellpadding="0" cellspacing="0" role="presentation" style="font-size:14px;line-height:1.8;">
                  ${data.vehicleMake !== 'Not provided' ? `
                  <tr>
                    <td style="color:#666666;padding:4px 0;width:130px;">Vehicle:</td>
                    <td style="color:#1a1a1a;padding:4px 0;font-weight:500;">${data.vehicleMake} ${data.vehicleModel}${data.vehicleReg !== 'Not provided' ? ` (${data.vehicleReg})` : ''}</td>
                  </tr>
                  ` : ''}
                  <tr>
                    <td style="color:#666666;padding:4px 0;">Service:</td>
                    <td style="color:#1a1a1a;padding:4px 0;font-weight:500;">${data.serviceType}</td>
                  </tr>
                  <tr>
                    <td style="color:#666666;padding:4px 0;">Postcode:</td>
                    <td style="color:#1a1a1a;padding:4px 0;font-weight:500;">${data.postcode}</td>
                  </tr>
                  ${data.preferredDate !== 'No preference' ? `
                  <tr>
                    <td style="color:#666666;padding:4px 0;">Preferred date:</td>
                    <td style="color:#1a1a1a;padding:4px 0;font-weight:500;">${data.preferredDate}</td>
                  </tr>
                  ` : ''}
                </table>
              </div>
            </td>
          </tr>

          <!-- What Happens Next -->
          <tr>
            <td style="padding:0 40px 30px;">
              <div style="background:#fff3e6;border-left:4px solid #FF6B35;padding:20px;border-radius:4px;">
                <h3 style="margin:0 0 12px;font-size:16px;font-weight:600;color:#1a1a1a;">What Happens Next</h3>
                <p style="margin:0 0 12px;font-size:14px;color:#333333;line-height:1.6;">Our team is now preparing your <strong>fixed price quote</strong>. You will shortly receive another email with:</p>
                <table width="100%" cellpadding="0" cellspacing="0" role="presentation" style="font-size:14px;color:#333333;line-height:1.8;">
                  <tr><td style="padding:2px 0;">• Your exact price</td></tr>
                  <tr><td style="padding:2px 0;">• Parts required (if applicable)</td></tr>
                  <tr><td style="padding:2px 0;">• Available appointment times</td></tr>
                  <tr><td style="padding:2px 0;">• Instructions to approve and book</td></tr>
                </table>
                <p style="margin:12px 0 0;font-size:13px;color:#666666;font-style:italic;">Nothing will be charged unless you approve the quote.</p>
              </div>
            </td>
          </tr>

          <!-- Call to Action -->
          <tr>
            <td align="center" style="padding:0 40px 40px;">
              <table cellpadding="0" cellspacing="0" role="presentation">
                <tr>
                  <td align="center" style="background-color:#17a2b8;border-radius:6px;">
                    <a href="tel:07354915941" style="display:inline-block;padding:14px 40px;font-size:16px;color:#ffffff;text-decoration:none;font-weight:600;">Call Us: 07354 915941</a>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- Contact Info -->
          <tr>
            <td align="center" style="padding:0 40px 30px;border-top:1px solid #e9ecef;padding-top:30px;">
              <p style="margin:0 0 5px;font-size:14px;color:#666666;">If you have any questions, please email us at</p>
              <p style="margin:0 0 15px;font-size:14px;">
                <a href="mailto:support@fixnowmechanics.co.uk" style="color:#17a2b8;text-decoration:none;font-weight:500;">support@fixnowmechanics.co.uk</a>
              </p>
              <p style="margin:0;font-size:13px;color:#999999;">or visit our <a href="https://www.fixnowmechanics.co.uk/services" style="color:#17a2b8;text-decoration:none;">Services</a> page. You can also chat with a real person during our operating hours.</p>
            </td>
          </tr>

          <!-- Footer Navigation -->
          <tr>
            <td align="center" style="padding:20px 40px;background-color:#f8f9fa;">
              <table cellpadding="0" cellspacing="0" role="presentation">
                <tr>
                  <td style="padding:0 10px;">
                    <a href="https://www.fixnowmechanics.co.uk" style="font-size:13px;color:#666666;text-decoration:none;">Home</a>
                  </td>
                  <td style="padding:0 10px;color:#cccccc;">|</td>
                  <td style="padding:0 10px;">
                    <a href="https://www.fixnowmechanics.co.uk/services" style="font-size:13px;color:#666666;text-decoration:none;">Services</a>
                  </td>
                  <td style="padding:0 10px;color:#cccccc;">|</td>
                  <td style="padding:0 10px;">
                    <a href="https://www.fixnowmechanics.co.uk/locations" style="font-size:13px;color:#666666;text-decoration:none;">Locations</a>
                  </td>
                  <td style="padding:0 10px;color:#cccccc;">|</td>
                  <td style="padding:0 10px;">
                    <a href="https://www.fixnowmechanics.co.uk/quote" style="font-size:13px;color:#666666;text-decoration:none;">Get Quote</a>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- Legal Footer -->
          <tr>
            <td align="center" style="padding:20px 40px 30px;background-color:#f8f9fa;">
              <p style="margin:0 0 10px;font-size:12px;color:#999999;line-height:1.5;">You have received this email as a customer of <a href="https://www.fixnowmechanics.co.uk" style="color:#17a2b8;text-decoration:none;">fixnowmechanics.co.uk</a></p>
              <p style="margin:0 0 15px;font-size:11px;color:#999999;">FixNow Mechanics • Mobile Repairs • 07354 915941</p>
              <p style="margin:0;font-size:11px;color:#cccccc;">This is an automated confirmation email. Please do not reply directly to this message.</p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
`;

const getProfessionalBusinessEmail = (data: any) => `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>New Quote Request</title>
</head>
<body style="margin:0;padding:0;font-family:Arial,'Helvetica Neue',Helvetica,sans-serif;background-color:#e7e7e7;">
  <table width="100%" cellpadding="0" cellspacing="0" role="presentation" style="background-color:#e7e7e7;">
    <tr>
      <td align="center" style="padding:40px 20px;">
        <table width="600" cellpadding="0" cellspacing="0" role="presentation" style="max-width:600px;width:100%;background-color:#ffffff;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
          
          <!-- Header -->
          <tr>
            <td style="background-color:#1a1a1a;padding:25px 30px;">
              <h2 style="margin:0;color:#FF6B35;font-size:22px;font-weight:700;">New Quote Request</h2>
              <p style="margin:5px 0 0;color:#cccccc;font-size:13px;">Action Required: Review and Respond</p>
            </td>
          </tr>
          
          <!-- Priority Alert -->
          <tr>
            <td style="padding:20px 30px 0;">
              <div style="background:#fff3cd;border-left:4px solid:#ffc107;padding:12px 15px;border-radius:4px;">
                <p style="margin:0;color:#856404;font-size:13px;font-weight:600;">Priority: Respond within 1 business day</p>
              </div>
            </td>
          </tr>

          <!-- Customer Info -->
          <tr>
            <td style="padding:25px 30px 5px;">
              <h3 style="margin:0 0 15px;font-size:16px;font-weight:600;color:#1a1a1a;border-bottom:2px solid #FF6B35;padding-bottom:8px;">Customer Information</h3>
